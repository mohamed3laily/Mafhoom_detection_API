<!DOCTYPE html>
<html>
  <head>
    <title>Real-Time Detection</title>
    <style>
      #output {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px;
        font-size: 20px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <video id="video" width="640" height="480" autoplay></video>
    <div id="output">Prediction: None</div>
    <script>
      async function sendFrame(frame) {
        try {
          let response = await fetch("http://127.0.0.1:5000/predict", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ frame: frame }),
          });
          let result = await response.json();
          console.log("Prediction:", result);
          updateOutput(result.predicted_class);
        } catch (error) {
          console.error("Error sending frame:", error);
        }
      }

      function updateOutput(prediction) {
        const outputDiv = document.getElementById("output");
        outputDiv.innerText = `Prediction: ${prediction}`;
      }

      function captureFrame(video) {
        let canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        let context = canvas.getContext("2d");
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        return canvas.toDataURL("image/jpeg").split(",")[1]; // Remove the prefix
      }

      async function startVideo() {
        const video = document.getElementById("video");
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          video.srcObject = stream;

          video.addEventListener("play", () => {
            setInterval(() => {
              let frame = captureFrame(video);
              sendFrame(frame);
            }, 100); // Capture and send a frame every 100 ms
          });
        } catch (error) {
          console.error("Error accessing camera:", error);
        }
      }

      window.onload = startVideo;
    </script>
  </body>
</html>
